@model HomeModel
@{
    ViewData["Title"] = "Search/Results List";
}

<div>
    <h2>Search</h2>
    <div>
        <div>
            <h4>Search Text:</h4>
            <input type="text" id="txtSearchText" class="form-control" style="width:400px;" />
        </div>
        <div style="padding-top:10px;">
            <h4>Search Categories:</h4>
            <label class="checkbox-inline"><input type="checkbox" id="chkCatMovie" value="" checked>Movies</label>
            <label class="checkbox-inline"><input type="checkbox" id="chkCatTV" value="">TV Shows</label>
            <label class="checkbox-inline"><input type="checkbox" id="chkCatOther" value="">Other</label>
        </div>
        <div style="padding-top:30px;">
            <input type="button" class="btn btn-primary btn-sm" value="Search" onclick="runSearch();" />
        </div>
    </div>
    <div style="margin-top:30px;border-top:1px solid black;padding-top:5px;">
        <table id="tblResults" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>Title</th>
                    <th style="width:120px;">Category</th>
                </tr>
            </thead>
            <tbody id="tblResultsBody">
            </tbody>
        </table>
    </div>
</div>


<script>
    $(function () {
        $('#tblResults').dataTable();
        $('#txtSearchText').on("keypress", function (e) {
            if (e.keyCode == 13) {
                runSearch();
                return false; // prevent the button click from happening
            }
        });
    });
    function runSearch() {
        $("#spanWaiting").show();
        var myTable = $('#tblResults').DataTable();
        myTable.clear();
        $.ajax({
            url: '/Home/Search/',
            type: 'GET',
            data: {
                searchText: $("#txtSearchText").val(),
                searchMovies: $('#chkCatMovie').is(":checked"),
                searchShows: $('#chkCatTV').is(":checked"),
                searchMisc: $('#chkCatOther').is(":checked")
            },
            success: function (data) {
                $("#spanWaiting").hide();
                for (i = 0; i <= data.length - 1; i++) {
                    myTable.row.add([data[i].fileName, data[i].category]);
                }
                myTable.draw();
            },
            fail: function (xhr, textStatus, errorThrown) {
                $("#spanWaiting").hide();
                alert('request failed');
            }
        });
    };
    
</script>
